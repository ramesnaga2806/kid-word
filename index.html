<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Kids Spelling with Repeat</title>
<style>
body { font-family: Comic Sans MS, Arial; background: linear-gradient(135deg,#fbc2eb,#a6c1ee); text-align:center; }
h1 { margin-top:20px; }
#parent{background:white;margin:20px;padding:20px;border-radius:20px;}
input[type=text],input[type=file]{font-size:20px;padding:10px;width:220px;margin:5px;}
button{font-size:18px;padding:10px 20px;border-radius:15px;border:none;background:#ff9a9e;margin:8px;}
#img{width:220px;height:220px;background:white;border-radius:20px;object-fit:cover;margin-top:20px;}
.word{font-size:70px;letter-spacing:15px;background:white;padding:20px;border-radius:25px;display:inline-block;margin:20px;}
</style>
</head>
<body>

<h1>üåà Kids Spelling Full üåà</h1>

<div id="parent">
<h2>Parent Area</h2>
<!-- Manual entry -->
<input type="text" id="wordInput" placeholder="APPLE"><br>
<input type="file" id="imgUpload" accept="image/*"><br>
<button onclick="addWord()">Add Word</button><br>

<!-- Upload file -->
<input type="file" id="fileUpload" accept=".txt,.csv"><br>
<button onclick="uploadFile()">Upload Words</button><br>

<button onclick="clearAll()">Clear All</button>
</div>

<img id="img" alt="Image will appear here">
<div class="word" id="wordBox"></div>
<br>
<button onclick="prevWord()">‚¨ÖÔ∏è Back</button>
<button onclick="nextWord()">Next ‚û°Ô∏è</button>
<button onclick="repeatWord()">üîÅ Repeat</button>

<script>
let words = JSON.parse(localStorage.getItem("kidsWords")) || [];
let index = 0;
let letterTimer;

// ADD single word manually
function addWord(){
    let w = document.getElementById("wordInput").value.trim().toUpperCase();
    if(!w) return alert("Enter a word");
    let imgFile = document.getElementById("imgUpload").files[0];

    if(imgFile){
        let reader = new FileReader();
        reader.onload = function(e){
            words.push({word:w,img:e.target.result});
            saveAndReset();
        }
        reader.readAsDataURL(imgFile);
    } else {
        words.push({word:w,img:null}); // null = auto-fetch image
        saveAndReset();
    }
}

// UPLOAD file (txt/csv)
function uploadFile(){
    let file = document.getElementById("fileUpload").files[0];
    if(!file) return alert("Select a file");
    let reader = new FileReader();
    reader.onload = function(e){
        let content = e.target.result;
        let lines = content.split(/\r?\n/);
        lines.forEach(line=>{
            let w = line.trim().toUpperCase();
            if(w) words.push({word:w,img:null});
        });
        saveAndReset();
        alert("Words uploaded!");
    }
    reader.readAsText(file);
}

// SAVE & RESET INPUTS
function saveAndReset(){
    localStorage.setItem("kidsWords", JSON.stringify(words));
    document.getElementById("wordInput").value="";
    document.getElementById("imgUpload").value="";
    document.getElementById("fileUpload").value="";
    showWord();
}

// CLEAR
function clearAll(){
    if(confirm("Clear all words?")){
        words=[];
        localStorage.removeItem("kidsWords");
        index=0;
        showWord();
    }
}

// LOAD AUTO IMAGE FROM INTERNET
function loadAutoImage(word){
    let img = document.getElementById("img");
    img.alt = "Loading image for " + word + "...";
    img.src = "https://source.unsplash.com/400x400/?" + encodeURIComponent(word) + "&sig=" + Date.now();
    img.onload = function(){ img.alt = word; }
}

// STOP CURRENT VOICE & TIMERS
function stopSpeech(){
    clearTimeout(letterTimer);
    speechSynthesis.cancel();
}

// SHOW WORD + IMAGE
function showWord(){
    if(words.length===0){
        document.getElementById("wordBox").innerHTML="No Words";
        document.getElementById("img").src="";
        return;
    }
    stopSpeech();
    if(index<0) index = words.length-1;
    if(index>=words.length) index = 0;

    let w = words[index];

    if(w.img && w.img.startsWith("data:")){ 
        document.getElementById("img").src = w.img;
    } else {
        loadAutoImage(w.word);
    }

    document.getElementById("wordBox").innerHTML="";
    speakLetters(w.word);
}

// SPEAK LETTERS + FULL WORD
function speakLetters(word){
    let letters = word.split("");
    let i = 0;

    function speakNext(){
        if(i < letters.length){
            document.getElementById("wordBox").innerHTML += letters[i]+" ";
            speak(letters[i],0.6);
            i++;
            letterTimer = setTimeout(speakNext, 900);
        } else {
            letterTimer = setTimeout(()=>speak(word,0.7), 800);
        }
    }
    speakNext();
}

// SPEAK FUNCTION
function speak(text, rate){
    let msg = new SpeechSynthesisUtterance(text);
    msg.rate = rate;
    msg.pitch = 1.3;
    speechSynthesis.speak(msg);
}

// NEXT WORD
function nextWord(){ stopSpeech(); index=(index+1)%words.length; showWord(); }

// PREVIOUS WORD
function prevWord(){ stopSpeech(); index=(index-1+words.length)%words.length; showWord(); }

// REPEAT CURRENT WORD
function repeatWord(){ stopSpeech(); 
    if(words.length>0) speakLetters(words[index].word); 
}

// START
showWord();
</script>

</body>
</html>
